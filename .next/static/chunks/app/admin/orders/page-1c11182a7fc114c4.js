(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{1360:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},2529:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3339:(e,s,a)=>{Promise.resolve().then(a.bind(a,6940))},5916:(e,s,a)=>{"use strict";function t(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat("en-GB",{style:"currency",currency:s}).format(e)}a.d(s,{v:()=>t})},6132:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6398:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},6485:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},6940:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A});var t=a(5155),r=a(2115),l=a(5916),n=a(3209),i=a(7003),c=a(7812),d=a(2319),o=a(2529),m=a(8874),u=a(6132),x=a(6983),h=a(6617),p=a(508),g=a(6485),v=a(8519),b=a(6398),y=a(1847);let j=(0,y.A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var f=a(9867);let N=(0,y.A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var k=a(1360);let w=[{value:"pending",label:"Pending",color:"bg-orange-100 text-orange-800"},{value:"processing",label:"Processing",color:"bg-blue-100 text-blue-800"},{value:"shipped",label:"Shipped",color:"bg-purple-100 text-purple-800"},{value:"delivered",label:"Delivered",color:"bg-green-100 text-green-800"},{value:"cancelled",label:"Cancelled",color:"bg-red-100 text-red-800"},{value:"refunded",label:"Refunded",color:"bg-gray-100 text-gray-800"}],_=[{value:"pending",label:"Pending"},{value:"paid",label:"Paid"},{value:"failed",label:"Failed"},{value:"refunded",label:"Refunded"}];function A(){let[e,s]=(0,r.useState)([]),[a,y]=(0,r.useState)(!1),[A,M]=(0,r.useState)(""),[C,E]=(0,r.useState)(null),[z,O]=(0,r.useState)(!1),[S,$]=(0,r.useState)({status:"",payment_status:"",tracking_number:"",notes:""});async function H(){y(!0),M("");try{let e=await fetch("/api/admin/orders");if(e.ok){let a=await e.json();s(a.orders||[])}else throw Error("Failed to load orders")}catch(e){M("Error loading orders: ".concat(e.message))}finally{y(!1)}}(0,r.useEffect)(()=>{H()},[]);let P=e=>{switch(null==e?void 0:e.toLowerCase()){case"completed":case"delivered":return(0,t.jsx)(o.A,{className:"h-4 w-4 text-green-500"});case"cancelled":case"refunded":return(0,t.jsx)(m.A,{className:"h-4 w-4 text-red-500"});case"processing":case"shipped":return(0,t.jsx)(u.A,{className:"h-4 w-4 text-blue-500"});default:return(0,t.jsx)(x.A,{className:"h-4 w-4 text-orange-500"})}},q=async(e,s,a,t,r)=>{M("");try{let l={status:s,payment_status:a};if(t&&(l.tracking_number=t),r&&(l.notes=r),!(await fetch("/api/admin/orders",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,updates:l})})).ok)throw Error("Failed to update order");M("Order updated successfully!"),O(!1),E(null),H()}catch(e){M("Error updating order: ".concat(e.message))}},Z=async e=>{if(confirm("Are you sure you want to delete this order? This action cannot be undone.")){M("");try{if(!(await fetch("/api/admin/orders",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e})})).ok)throw Error("Failed to delete order");M("Order deleted successfully!"),H()}catch(e){M("Error deleting order: ".concat(e.message))}}};return(0,t.jsxs)(d.A,{children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Order Management"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Manage customer orders, update statuses, and track shipments"})]}),A&&(0,t.jsx)(n.Zp,{className:"mb-6 ".concat(A.includes("Error")?"border-red-200 bg-red-50":"border-green-200 bg-green-50"),children:(0,t.jsx)(n.Wu,{className:"p-4",children:(0,t.jsx)("p",{className:A.includes("Error")?"text-red-700":"text-green-700",children:A})})}),a?(0,t.jsx)(n.Zp,{children:(0,t.jsx)(n.Wu,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),(0,t.jsx)("span",{className:"ml-3",children:"Loading orders..."})]})})}):0===e.length?(0,t.jsx)(n.Zp,{children:(0,t.jsxs)(n.Wu,{className:"p-8 text-center",children:[(0,t.jsx)(h.A,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders found"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Orders will appear here once customers start purchasing."})]})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:w.slice(0,4).map(s=>{let a=e.filter(e=>e.status===s.value).length;return(0,t.jsx)(n.Zp,{children:(0,t.jsx)(n.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:s.label}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:a})]}),(0,t.jsx)("div",{className:"p-3 rounded-full ".concat(s.color.replace("text-","text-").replace("bg-","bg-")),children:P(s.value)})]})})},s.value)})}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"h-5 w-5"}),"All Orders (",e.length,")"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>{var s,a,r;let n;return(0,t.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg",children:["Order #",e.id]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(p.A,{className:"h-4 w-4"}),e.user_id.substring(0,8),"..."]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(g.A,{className:"h-4 w-4"}),new Date(e.created_at).toLocaleDateString("en-GB")]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(h.A,{className:"h-4 w-4"}),(null==(n=e.order_items)?void 0:n.reduce((e,s)=>e+s.quantity,0))||0," items"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(e=>{let s=w.find(s=>s.value===(null==e?void 0:e.toLowerCase()))||w[0];return(0,t.jsx)(c.E,{className:"".concat(s.color," border-0"),children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[P(e),s.label]})})})(e.status),(0,t.jsxs)(c.E,{variant:"outline",className:"flex items-center gap-1",children:[(0,t.jsx)(v.A,{className:"h-3 w-3"}),(null==(s=e.payment_status)?void 0:s.charAt(0).toUpperCase())+(null==(a=e.payment_status)?void 0:a.slice(1))]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 overflow-x-auto mb-2",children:[null==(r=e.order_items)?void 0:r.slice(0,3).map((e,s)=>{var a,r;return(0,t.jsxs)("div",{className:"flex-shrink-0 flex items-center gap-2 bg-white border rounded p-2 min-w-[200px]",children:[(null==(a=e.parts)?void 0:a.image_url)&&(0,t.jsx)("img",{src:e.parts.image_url,alt:e.parts.name,className:"w-10 h-10 rounded object-cover"}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",children:null==(r=e.parts)?void 0:r.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Qty: ",e.quantity," \xd7 ",(0,l.v)(e.price)]})]})]},s)}),e.order_items&&e.order_items.length>3&&(0,t.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-center w-16 h-16 bg-gray-100 border rounded text-xs text-gray-600",children:["+",e.order_items.length-3]})]}),e.tracking_number&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-blue-600",children:[(0,t.jsx)(b.A,{className:"h-4 w-4"}),"Tracking: ",e.tracking_number]})]}),(0,t.jsxs)("div",{className:"flex flex-col lg:items-end gap-2",children:[(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-2xl font-bold",children:(0,l.v)(e.total_amount)})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{E(e),$({status:e.status||"pending",payment_status:e.payment_status||"pending",tracking_number:e.tracking_number||"",notes:e.notes||""}),O(!0)},children:[(0,t.jsx)(j,{className:"h-4 w-4 mr-1"}),"Edit"]}),"paid"===e.payment_status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>{var s;return s=e.id,void window.open("/api/admin/orders/".concat(s,"/invoice"),"_blank")},className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"Admin Invoice"]}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>window.open("/api/orders/".concat(e.id,"/invoice"),"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[(0,t.jsx)(N,{className:"h-4 w-4 mr-1"}),"Customer Invoice"]})]}),"pending"===e.payment_status&&(0,t.jsx)(i.$,{size:"sm",onClick:()=>q(e.id,e.status,"paid",e.tracking_number||"",e.notes||""),className:"bg-green-500 hover:bg-green-600 text-white",children:"Mark Paid"}),"paid"===e.payment_status&&"pending"===e.status&&(0,t.jsx)(i.$,{size:"sm",onClick:()=>q(e.id,e.status,"pending",e.tracking_number||"",e.notes||""),className:"bg-orange-500 hover:bg-orange-600 text-white",children:"Mark Unpaid"}),"pending"===e.status&&(0,t.jsx)(i.$,{size:"sm",onClick:()=>q(e.id,"processing",e.payment_status,e.tracking_number||"",e.notes||""),className:"bg-blue-500 hover:bg-blue-600",children:"Process"}),"processing"===e.status&&(0,t.jsx)(i.$,{size:"sm",onClick:()=>q(e.id,"shipped",e.payment_status,e.tracking_number||"",e.notes||""),className:"bg-purple-500 hover:bg-purple-600",children:"Ship"}),"shipped"===e.status&&(0,t.jsx)(i.$,{size:"sm",onClick:()=>q(e.id,"delivered",e.payment_status,e.tracking_number||"",e.notes||""),className:"bg-green-500 hover:bg-green-600",children:"Deliver"}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>Z(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]})},e.id)})})})]})]}),z&&C&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,t.jsxs)(n.Zp,{className:"w-full max-w-md",children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{children:["Edit Order #",C.id]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Order Status"}),(0,t.jsx)("select",{value:S.status,onChange:e=>$(s=>({...s,status:e.target.value})),className:"w-full p-2 border rounded-lg",children:w.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Payment Status"}),(0,t.jsx)("select",{value:S.payment_status,onChange:e=>$(s=>({...s,payment_status:e.target.value})),className:"w-full p-2 border rounded-lg",children:_.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Tracking Number"}),(0,t.jsx)("input",{type:"text",value:S.tracking_number,onChange:e=>$(s=>({...s,tracking_number:e.target.value})),placeholder:"Enter tracking number (optional)",className:"w-full p-2 border rounded-lg"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:S.notes,onChange:e=>$(s=>({...s,notes:e.target.value})),placeholder:"Add internal notes (optional)",rows:3,className:"w-full p-2 border rounded-lg"})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,t.jsx)(i.$,{onClick:()=>q(C.id,S.status,S.payment_status,S.tracking_number,S.notes),className:"flex-1",children:"Update Order"}),(0,t.jsx)(i.$,{variant:"outline",onClick:()=>{O(!1),E(null)},className:"flex-1",children:"Cancel"})]})]})})]})})]})}},6983:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},7812:(e,s,a)=>{"use strict";a.d(s,{E:()=>i});var t=a(5155);a(2115);var r=a(3101),l=a(5016);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("div",{className:(0,l.cn)(n({variant:a}),s),...r})}},8874:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9867:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])}},e=>{e.O(0,[494,619,319,441,255,358],()=>e(e.s=3339)),_N_E=e.O()}]);